# 索引目录
[OSI/RM模型](#osirm模型)
 - [物理层](#物理层)

 - [数据链路层](#osirm模型---数据链路层协议---帧frame)

 - [网络层](#osirm模型---网络层---数据包分组packet)

 - [传输层](#osirm模型---传输层---段segment)

 - [会话层](#osirm模型---会话层---数据data)

 - [表示层](#osirm模型---表示层---数据data)

 - [应用层](#osirm模型---应用层---数据data)

[局域网(LAN)](#局域网lan)
   - [802.3 MAC帧格式](#8023-mac帧格式)
   - [802.3 物理层标准](#8023-物理层标准)
   - [总线竞争型媒体访问控制方法](#总线竞争型媒体访问控制方法)
   - [载体侦听多路访问/冲突检测,即CSMA/CD协议](#载体侦听多路访问冲突检测即csmacd协议)

[TCP/IP 网络通信协议](#tcpip-网络通信协议)
   - [TCP/IP的结构](#tcpip的结构)
   - [TCP/IP协议族](#tcpip)

   + [网络层协议](#网络层协议)
        + [IP](#ipv4即ip)
        - [IP地址](#ip地址)
        - [ARP和RARP](#arp和rarp)
        - [ARP报文格式](#arp报文格式)
        - [ICMP](#icmp)

   + [传输层协议](#传输层协议)
        - [TCP](#tcp)
        - [UDP](#udp)
        - [滑窗协议](#滑窗协议)
        - **[三次握手](#建立连接-三次握手)**
        - **[四次挥手](#关闭连接-四次挥手)**

   + [应用层协议](#dns协议---应用层协议)
        - [应用层协议](#http---应用层协议)

[网络设备与网络互连](#网络设备与网络互连)

[广域网](#广域网)

[网络安全](#网络安全)

# 计算机网络知识点整理
 
## 基础术语整理
 
####  结点(node):

    网络中的结点可以是计算机，集线器，交换机或路由器等。
####   链路(link  ):

    从一个结点到另一个结点的一段物理线路。中间没有任何其他交点。
####  主机(host):
    连接在因特网上的计算机.
####  ISP(Internet Service Provider): 
    因特网服务提供者(提供商).
####  IXP(Internet eXchange Point): 
    互联网交换点IXP的主要作用就是允许两个网络直接相连并交换分组，而不需要再通过第三个网络来转发分组。.
####  RFC(Request For Comments) 
    意思是“请求评议”，包含了关于Internet几乎所有的重要的文字资料。
####  广域网WAN(Wide Area Network)
    任务是通过长距离运送主机发送的数据
####  城域网MAN(Metropolitan Area Network)
    用来讲多个局域网进行互连

####  局域网LAN(Local Area Network)
     学校或企业大多拥有多个互连的局域网
####  个人区域网PAN(Personal Area Network)
    在个人工作的地方把属于个人使用的电子设备用无线技术连接起来的网络  
####    端系统(end system):  
    处在因特网边缘的部分即是连接在因特网上的所有的主机.
####  分组(packet ):
    因特网中传送的数据单元。由首部header和数据段组成。分组又称为包，首部可称为包头。
####  存储转发(store and forward ): 
    路由器收到一个分组，先存储下来，再检查气首部，查找转发表，按照首部中的目的地址，找到合适的接口转发出去。
####  带宽(bandwidth):
    在计算机网络中，表示在单位时间内从网络中的某一点到另一点所能通过的“最高数据率”。
    常用来表示网络的通信线路所能传送数据的能力。单位是“比特每秒”，记为b/s。
####  吞吐量(throughput ): 
    表示在单位时间内通过某个网络(或信道、接口)的数据量。
    吞吐量更经常地用于对现实世界中的网络的一种测量，以便知道实际上到底有多少数据量能够通过网络。
    吞吐量受网络的带宽或网络的额定速率的限制。
    
### 重要知识点总结
    
 1， 计算机网络(简称网络)把许多计算机连接在一起，而互联网把许多网络连接在一起，是网络的网络。
    
2， 小写字母i开头的internet(互联网)是通用名词，它泛指由多个计算机网络相互连接而成的网络。在这些网络之间的通信协议(即通信规则)可以是任意的。
    
大写字母I开头的Internet(互联网)是专用名词，它指全球最大的，开放的，由众多网络相互连接而成的特定的互联网，并采用TCP/IP协议作为通信规则，其前身为ARPANET。Internet的推荐译名为因特网，现在一般流行称为互联网。
    
3， 路由器是实现分组交换的关键构件，其任务是转发受到的分组，这是网络核心部分最重要的功能。分组交换采用存储转发技术，表示把一个报文(要发送的整块数据)分为几个分组后在进行传送。在发送报文之前，先把较长的报文划分成为一个个更小的等长数据段。在每个数据端的前面加上一些由必要的控制信息组成的首部后，就构成了一个分组。分组有称为包。分组是在互联网中传送的数据单元，正式由于分组的头部包含了诸如目的地址和源地址等重要控制信息，每一个分组才能在互联网中独立的选择传输路径，并正确地交付到分组传输的终点。
    
4，互联网按工作方式可划分为边缘部分和核心部分。主机在网络的边缘部分，其作用是进行信息处理。由大量网络和连接这些网络的路由西组成边缘部分，其作用是提供连通性和交换。
    
5，计算机通信是计算机中进程(即运行着的程序)之间的通信。计算机网络采用的通信方式是客户-服务器方式(C/S方式)和对等连接方式(P2P方式)。
     
6，客户和服务器都是指通信中所涉及的应用进程。客户是服务请求方，服务器是服务提供方。
     
7，按照作用范围的不同，计算机网络分为广域网WAN，城域网MAN,局域网LAN，个人区域网PAN。
    
8，计算机网络最常用的性能指标是：速率，带宽，吞吐量，时延(发送时延，处理时延，排队时延)，时延带宽积，往返时间和信道利用率。
     
9，网络协议即协议，是为进行网络中的数据交换而建立的规则。计算机网络的各层以及其协议集合，称为网络的体系结构。
     
10，五层体系结构由应用层，运输层，网络层(网际层)，数据链路层，物理层组成。运输层最主要的协议是TCP和UDP协议，网络层最重要的协议是IP协议。

## OSI/RM模型

## 七层模型总图

![](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93.gif)

### 物理层
#### 基本术语整理
##### 数据(data):
    运送消息的实体。
##### 信号(signal):
    数据的电气的或电磁的表现。或者说信号是适合在传输介质上传输的对象。
##### 码元( code): 
    在使用时间域(或简称为时域)的波形来表示数字信号时，代表不同离散数值的基本波形。
##### 单工(simplex ):
    只能有一个方向的通信而没有反方向的交互。
##### 半双工(half duplex ):
    通信的双方都可以发送信息，但不能双方同时发送(当然也就不能同时接收)。
##### 全双工(full duplex): 
    通信的双方可以同时发送和接收信息。
##### 奈氏准则:
    在任何信道中，码元的传输的效率是有上限的，传输速率超过此上限，就会出现严重的码间串扰问题
	使接收端对码元的判决(即识别)成为不可能。
##### 基带信号(baseband signal):
    来自信源的信号。指没有经过调制的数字信号或模拟信号。
#####  带通(频带)信号(bandpass signal):
    把基带信号经过载波调制后，把信号的频率范围搬移到较高的频段以便在信道中传输(即仅在一段频率范围内能够通过信道)
	这里调制过后的信号就是带通信号。
#####  调制(modulation  ):
    对信号源的信息进行处理后加到载波信号上，使其变为适合在信道传输的形式的过程。
##### 信噪比(signal-to-noise ratio ):
    指信号的平均功率和噪声的平均功率之比，记为S/N。信噪比(dB)=10*log10(S/N)
##### 信道复用(channel multiplexing ):
    指多个用户共享同一个信道。(并不一定是同时)
##### 比特率(bit rate ):
    单位时间(每秒)内传送的比特数。
##### 波特率(baud rate):
    单位时间载波调制状态改变的次数。针对数据信号对载波的调制速率。
##### 复用(multiplexing):
    共享信道的方法
##### ADSL(Asymmetric Digital Subscriber Line    ): 
    非对称数字用户线。
##### 光纤同轴混合网(HFC网):
    在目前覆盖范围很广的有线电视网的基础上开发的一种居民宽带接入网
	
## 重要知识点总结

 1，物理层的主要任务就是确定与传输媒体接口有关的一些特性，如机械特性，电气特性，功能特性，过程特性。

 2，一个数据通信系统可划分为三大部分，即源系统，传输系统，目的系统。源系统包括源点(或源站，信源)和发送器，目的系统包括接收器和终点。

 3，通信的目的是传送消息。如话音，文字，图像等都是消息，数据是运送消息的实体。信号则是数据的电器或电磁的表现。

 4，根据信号中代表消息的参数的取值方式不同，信号可分为模拟信号(或连续信号)和数字信号(或离散信号)。在使用时间域(简称时域)的波形表示数字信号时，代表不同离散数值的基本波形称为码元。

 5，根据双方信息交互的方式，通信可划分为单向通信(或单工通信)，双向交替通信(或半双工通信)，双向同时通信(全双工通信)。

 6，来自信源的信号称为基带信号。信号要在信道上传输就要经过调制。调制有基带调制和带通调制之分。最基本的带通调制方法有调幅，调频和调相。还有更复杂的调制方法，如正交振幅调制。

 7，要提高数据在信道上的传递速率，可以使用更好的传输媒体，或使用先进的调制技术。但数据传输速率不可能任意被提高。

 8，传输媒体可分为两大类，即导引型传输媒体(双绞线，同轴电缆，光纤)和非导引型传输媒体(无线，红外，大气激光)。

 9，为了有效利用光纤资源，在光纤干线和用户之间广泛使用无源光网络PON。无源光网络无需配备电源，其长期运营成本和管理成本都很低。最流行的无源光网络是以太网无源光网络EPON和吉比特无源光网络GPON。
 
 ### 最重要的知识点
#### **物理层的任务**
 透明地传送比特流。也可以将物理层的主要任务描述为确定与传输媒体的接口的一些特性，即:机械特性(接口所用接线器的一些物理属性如形状尺寸)，电气特性(接口电缆的各条线上出现的电压的范围)，功能特性(某条线上出现的某一电平的电压的意义)，过程特性(对于不同功能能的各种可能事件的出现顺序)。

#### 拓展:
 物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。现有的计算机网络中的硬件设备和传输媒体的种类非常繁多，而且通信手段也有许多不同的方式。物理层的作用正是尽可能地屏蔽掉这些传输媒体和通信手段的差异，使物理层上面的数据链路层感觉不到这些差异，这样就可以使数据链路层只考虑完成本层的协议和服务，而不必考虑网络的具体传输媒体和通信手段是什么。

#### **几种常用的信道复用技术**
![这里写图片描述](https://user-gold-cdn.xitu.io/2018/4/1/1627f7a170ec6611?w=1247&h=425&f=png&s=36746)

### **几种常用的宽带接入技术，主要是ADSL和FTTx**
 用户到互联网的宽带接入方法有非对称数字用户线ADSL(用数字技术对现有的模拟电话线进行改造，而不需要重新布线。ASDL的快速版本是甚高速数字用户线VDSL。)，光纤同轴混合网HFC(是在目前覆盖范围很广的有线电视网的基础上开发的一种居民宽带接入网)和FTTx(即光纤到······)。

## OSI/RM模型---数据链路层协议---帧(frame)

### 基本术语

####  链路(link):
    一个结点到相邻结点的一段物理链路
####  数据链路(data link):
    把实现控制数据运输的协议的硬件和软件加到链路上就构成了数据链路
####  循环冗余检验CRC(Cyclic Redundancy Check):
    为了保证数据传输的可靠性，CRC是数据链路层广泛使用的一种检错技术
####   帧(frame):
    一个数据链路层的传输单元，由一个数据链路层首部和其携带的封包所组成协议数据单元。
####  MTU(Maximum Transfer Uint  ):
    最大传送单元。帧的数据部分的的长度上限。
####  误码率BER(Bit Error Rate ):
    在一段时间内，传输错误的比特占所传输比特总数的比率。
####  PPP(Point-to-Point Protocol  ):
    点对点协议。即用户计算机和ISP进行通信时所使用的数据链路层协议。以下是PPP帧的示意图:
![PPP](https://user-gold-cdn.xitu.io/2018/4/1/1627f8291c6b032c?w=624&h=359&f=jpeg&s=44271)
####  MAC地址(Media Access Control或者Medium Access Control):
    意译为媒体访问控制，或称为物理地址、硬件地址，用来定义网络设备的位置。
    在OSI模型中，第三层网络层负责 IP地址，第二层数据链路层则负责 MAC地址。
    因此一个主机会有一个MAC地址，而每个网络位置会有一个专属于它的IP地址  。
    地址是识别某个系统的重要标识符，“名字指出我们所要寻找的资源，地址指出资源所在的地方，路由告诉我们如何到达该处”
####  网桥(bridge):
     一种用于数据链路层实现中继，连接两个或多个局域网的网络互连设备。
####  交换机(switch ):
    广义的来说，交换机指的是一种通信系统中完成信息交换的设备。
    这里工作在数据链路层的交换机指的是交换式集线器，其实质是一个多接口的网桥
   

## 重要知识点总结

1. 链路是从一个结点到相邻节点的一段物理链路，数据链路则在链路的基础上增加了一些必要的硬件(如网络适配器)和软件(如协议的实现)

2. 数据链路层使用的主要是**点对点信道**和**广播信道**两种。

3. 数据链路层传输的协议数据单元是帧。数据链路层的三个基本问题是:**封装成帧**，**透明传输**和**差错检测**

4. **循环冗余检验CRC**是一种检错方法，而帧检验序列FCS是添加在数据后面的冗余码

5. **点对点协议PPP**是数据链路层使用最多的一种协议，它的特点是:简单，只检测差错而不去纠正差错，不使用序号，也不进行流量控制，可同时支持多种网络层协议

6. PPPoE是为宽带上网的主机使用的链路层协议

7. 局域网的优点是:具有广播功能，从一个站点可方便地访问全网;便于系统的扩展和逐渐演变;提高了系统的可靠性，可用性和生存性。

8. 共向媒体通信资源的方法有二:一是静态划分信道(各种复用技术)，而是动态媒体接入控制，又称为多点接入(随即接入或受控接入)

9. 计算机与外接局域网通信需要通过通信适配器(或网络适配器)，它又称为网络接口卡或网卡。**计算器的硬件地址就在适配器的ROM中**。

10. 以太网采用的无连接的工作方式，对发送的数据帧不进行编号，也不要求对方发回确认。目的站收到有差错帧就把它丢掉，其他什么也不做

11. 以太网采用的协议是具有冲突检测的**载波监听多点接入CSMA/CD**。协议的特点是:**发送前先监听，边发送边监听，一旦发现总线上出现了碰撞，就立即停止发送。然后按照退避算法等待一段随机时间后再次发送。** 因此，每一个站点在自己发送数据之后的一小段时间内，存在这遭遇碰撞的可能性。以太网上的各站点平等的争用以太网信道

12. 以太网的适配器具有过滤功能，它只接收单播帧，广播帧和多播帧。

13. 使用集线器可以在物理层扩展以太网(扩展后的以太网任然是一个网络)

### 最重要的知识点
#### ①数据链路层的点对点信道和广播信道的特点，以及这两种信道所使用的协议(PPP协议以及CSMA/CD协议)的特点
#### ② 数据链路层的三个基本问题:**封装成帧**，**透明传输**，**差错检测**
#### ③ 以太网的MAC层硬件地址
#### ④ 适配器，转发器，集线器，网桥，以太网交换机的作用以及适用场合



#### 面向字符协议
利用已定义好的一种代码字符集的一个子集来执行通信控制功能 --- 具体协议有 ISO 1745,BSC

该协议面临的问题: 

1. 字符集不同
2. 数据字符和控制字符的区分
3. 控制字符占用了可传输信息的空间
4. 透明性差，需要复杂的转义技术(DLE)

注:透明性，指链路控制与传输的代码结构完全无关

#### 面向位协议
以位置来定位各个字段，各字段内均由位的各种组合组成，并以帧为统一的传输单位
具体协议有 
* SDLC 
* ADCCP 
* HDLC
* LAP 
* LAPB
注:这些协议内容基本相同

### OSI/RM模型---网络层---数据包/分组(packet)

### 基本术语

#### 虚电路(Virtual Circuit)
    在两个终端设备的逻辑或物理端口之间，通过建立的双向的透明传输通道。虚电路表示这只是一条逻辑上的连接，分组都沿着这条逻辑连接按照存储转发方式传送，而并不是真正建立了一条物理连接。
#### IP(Internet Protocol )
    网际协议 IP 是 TCP/IP体系中两个最主要的协议之一，是TCP/IP体系结构网际层的核心。配套的有ARP，RARP，ICMP，IGMP。
 ![](https://user-gold-cdn.xitu.io/2018/4/1/1627f92f98436286?w=453&h=331&f=jpeg&s=27535)
#### ARP(Address Resolution Protocol)
    地址解析协议
#### ICMP(Internet Control Message Protocol )
    网际控制报文协议  (ICMP 允许主机或路由器报告差错情况和提供有关异常情况的报告。)
#### 子网掩码(subnet mask )
    它是一种用来指明一个IP地址的哪些位标识的是主机所在的子网以及哪些位标识的是主机的位掩码。子网掩码不能单独存在，它必须结合IP地址一起使用。
####  CIDR( Classless Inter-Domain Routing )
    无分类域间路由选择  (特点是消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念，并使用各种长度的“网络前缀”(network-prefix)来代替分类地址中的网络号和子网号)
#### 默认路由(default route)
    当在路由表中查不到能到达目的地址的路由时，路由器选择的路由。默认路由还可以减小路由表所占用的空间和搜索路由表所用的时间。
#### 路由选择算法(Virtual Circuit)
    路由选择协议的核心部分。因特网采用自适应的，分层次的路由选择协议。

### 重要知识点总结
:1，TCP/IP协议中的网络层向上只提供简单灵活的，无连接的，尽最大努力交付的数据报服务。网络层不提供服务质量的承诺，不保证分组交付的时限所传送的分组可能出错，丢失，重复和失序。进程之间通信的可靠性由运输层负责

:2，在互联网的交付有两种，一是在本网络直接交付不用经过路由器，另一种是和其他网络的间接交付，至少经过一个路由器，但最后一次一定是直接交付

:3，分类的IP地址由网络号字段(指明网络)和主机号字段(指明主机)组成。网络号字段最前面的类别指明IP地址的类别。IP地址市一中分等级的地址结构。IP地址管理机构分配IP地址时只分配网络号，主机号由得到该网络号的单位自行分配。路由器根据目的主机所连接的网络号来转发分组。一个路由器至少连接到两个网络，所以一个路由器至少应当有两个不同的IP地址

:4，IP数据报分为首部和数据两部分。首部的前一部分是固定长度，共20字节，是所有IP数据包必须具有的(源地址，目的地址，总长度等重要地段都固定在首部)。一些长度可变的可选字段固定在首部的后面。IP首部中的生存时间给出了IP数据报在互联网中所能经过的最大路由器数。可防止IP数据报在互联网中无限制的兜圈子。

5，地址解析协议ARP把IP地址解析为硬件地址。ARP的高速缓存可以大大减少网络上的通信量。因为这样可以使主机下次再与同样地址的主机通信时，可以直接从高速缓存中找到所需要的硬件地址而不需要再去广播方式发送ARP请求分组

6，无分类域间路由选择CIDR是解决目前IP地址紧缺的一个好办法。CIDR记法把IP地址后面加上斜线“/”，然后写上前缀所所占的位数。前缀(或网络前缀用来指明网络)，前缀后面的部分是后缀，用来指明主机。CIDR把前缀都相同的连续的IP地址组成一个“CIDR地址块”，IP地址分配都以CIDR地址块为单位。

7， 网际控制报文协议是IP层的协议.ICMP报文作为IP数据报的数据，加上首部后组成IP数据报发送出去。使用ICMP数据报并不是为了实现可靠传输。ICMP允许主机或路由器报告差错情况和提供有关异常情况的报告。ICMP报文的种类有两种   ICMP差错报告报文和ICMP询问报文。

8，要解决IP地址耗尽的问题，最根本的办法是采用具有更大地址弓箭的新版本IP协议-IPv6。IPv6所带来的变化有①更大的地址空间(采用128位地址)②灵活的首部格式③改进的选项④支持即插即用⑤支持资源的预分配⑥IPv6的首部改为8字节对齐。另外IP数据报的目的地址可以是以下三种基本类型地址之一：单播，多播和任播

9，虚拟专用网络VPN利用公用的互联网作为本机构专用网之间的通信载体。VPN内使用互联网的专用地址。一个VPN至少要有一个路由器具有合法的全球IP地址，这样才能和本系统的另一个VPN通过互联网进行通信。所有通过互联网传送的数据都需要加密

10， MPLS的特点是：
1. 支持面向连接的服务质量
2. 支持流量工程，平衡网络负载
3. 有效的支持虚拟专用网VPN。MPLS在入口节点给每一个IP数据报打上固定长度的“标记”,然后根据标记在第二层(链路层)用硬件进行转发(在标记交换路由器中进行标记交换)，因而转发速率大大加快。</font>

## 最重要知识点
#### ①虚拟互联网络的概念
#### ②IP地址和物理地址的关系
#### ③ 传统的分类的IP地址(包括子网掩码)和误分类域间路由选择CIDR
#### ④  路由选择协议的工作原理

#### X.25协议:定义了用户主机(数据终端设备，DTE)和报文分组网通信设备(数据终接设备，DCE)。
	具体地说，它是3个对等协议的组合:
	- DTE和DCE物理实体之间对等层协议
	- DTE和DCE数据链路层之间的对等层协议
	- DTE和DCE网络层之间的对等层协议
它定义了这三个层在DTE和DCE之间交换信息的格式和意义。(即包含了三个协议层)
### OSI/RM模型---传输层---段(segment)

### 基本术语

#### 进程(process)
    指计算机中正在运行的程序实体
#### 应用进程互相通信
    一台主机的进程和另一台主机中的一个进程交换数据的过程(另外注意通信真正的端点不是主机而是主机中的进程，也就是说端到端的通信是应用进程之间的通信)
#### 传输层的复用与分用
    复用指发送方不同的进程都可以通过统一个运输层协议传送数据。分用指接收方的运输层在剥去报文的首部后能把这些数据正确的交付到目的应用进程。
#### TCP(Transmission Control Protocol)
    传输控制协议
#### UDP(User Datagram Protocol)
    用户数据报协议
#### 端口(port)(link)
    端口的目的是为了确认对方机器是那个进程在于自己进行交互，比如MSN和QQ的端口不同，如果没有端口就可能出现QQ进程和MSN交互错误。端口又称协议端口号。
#### 停止等待协议(link)
    指发送方每发送完一个分组就停止发送，等待对方确认，在收到确认之后在发送下一个分组。
#### 流量控制(link)
    就是让发送方的发送速率不要太快，既要让接收方来得及接收，也不要使网络发生拥塞。
#### 拥塞控制(link)
    防止过多的数据注入到网络中，这样可以使网络中的路由器或链路不致过载。拥塞控制所要做的都有一个前提，就是网络能够承受现有的网络负荷。


### 重要知识点总结

1，运输层提供应用进程之间的逻辑通信，也就是说，运输层之间的通信并不是真正在两个运输层之间直接传输数据。运输层向应用层屏蔽了下面网络的细节(如网络拓补，所采用的路由选择协议等)，它使应用进程之间看起来好像两个运输层实体之间有一条端到端的逻辑通信信道。

2，网络层为主机提供逻辑通信，而运输层为应用进程之间提供端到端的逻辑通信。

3，运输层的两个重要协议是用户数据报协议UDP和传输控制协议TCP。按照OSI的术语，两个对等运输实体在通信时传送的数据单位叫做运输协议数据单元TPDU(Transport Protocol Data Unit)。但在TCP/IP体系中，则根据所使用的协议是TCP或UDP，分别称之为TCP报文段或UDP用户数据报。

4，UDP在传送数据之前不需要先建立连接，远地主机在收到UDP报文后，不需要给出任何确认。虽然UDP不提供可靠交付，但在某些情况下UDP确是一种最有效的工作方式。 TCP提供面向连接的服务。在传送数据之前必须先建立连接，数据传送结束后要释放连接。TCP不提供广播或多播服务。由于TCP要提供可靠的，面向连接的运输服务，这一难以避免增加了许多开销，如确认，流量控制，计时器以及连接管理等。这不仅使协议数据单元的首部增大很多，还要占用许多处理机资源。

5，硬件端口是不同硬件设备进行交互的接口，而软件端口是应用层各种协议进程与运输实体进行层间交互的一种地址。UDP和TCP的首部格式中都有源端口和目的端口这两个重要字段。当运输层收到IP层交上来的运输层报文时，就能够 根据其首部中的目的端口号把数据交付应用层的目的应用层。(两个进程之间进行通信不光要知道对方IP地址而且要知道对方的端口号(为了找到对方计算机中的应用进程))

6，运输层用一个16位端口号标志一个端口。端口号只有本地意义，它只是为了标志计算机应用层中的各个进程在和运输层交互时的层间接口。在互联网的不同计算机中，相同的端口号是没有关联的。协议端口号简称端口。虽然通信的终点是应用进程，但只要把所发送的报文交到目的主机的某个合适端口，剩下的工作(最后交付目的进程)就由TCP和UDP来完成。

7，运输层的端口号分为服务器端使用的端口号(0-1023指派给熟知端口，1024-49151是登记端口号)和客户端暂时使用的端口号(49152-65535)

8，UDP的主要特点是①无连接②尽最大努力交付③面向报文④无拥塞控制⑤支持一对一，一对多，多对一和多对多的交互通信⑥首部开销小(只有四个字段：源端口，目的端口，长度和检验和)

9，TCP的主要特点是①面向连接②每一条TCP连接只能是一对一的③提供可靠交付④提供全双工通信⑤面向字节流

10，TCP用主机的IP地址加上主机上的端口号作为TCP连接的端点。这样的端点就叫做套接字(socket)或插口。套接字用(IP地址：端口号)来表示。每一条TCP连接唯一被通信两端的两个端点所确定。

11，停止等待协议是为了实现可靠传输的，它的基本原理就是每发完一个分组就停止发送，等待对方确认。在收到确认后再发下一个分组。

12，为了提高传输效率，发送方可以不使用低效率的停止等待协议，而是采用流水线传输。流水线传输就是发送方可连续发送多个分组，不必每发完一个分组就停下来等待对方确认。这样可使信道上一直有数据不间断的在传送。这种传输方式可以明显提高信道利用率。

13，停止等待协议中超时重传是指只要超过一段时间仍然没有收到确认，就重传前面发送过的分组(认为刚才发送过的分组丢失了)。因此每发送完一个分组需要设置一个超时计时器，其重转时间应比数据在分组传输的平均往返时间更长一些。这种自动重传方式常称为自动重传请求ARQ。另外在停止等待协议中若收到重复分组，就丢弃该分组，但同时还要发送确认。连续ARQ协议可提高信道利用率。发送维持一个发送窗口，凡位于发送窗口内的分组可连续发送出去，而不需要等待对方确认。接收方一般采用累积确认，对按序到达的最后一个分组发送确认，表明到这个分组位置的所有分组都已经正确收到了。

14，TCP报文段的前20个字节是固定的，后面有4n字节是根据需要增加的选项。因此，TCP首部的最小长度是20字节。

15，TCP使用滑动窗口机制。发送窗口里面的序号表示允许发送的序号。发送窗口后沿的后面部分表示已发送且已收到确认，而发送窗口前沿的前面部分表示不晕与发送。发送窗口后沿的变化情况有两种可能，即不动(没有收到新的确认)和前移(收到了新的确认)。发送窗口的前沿通常是不断向前移动的。一般来说，我们总是希望数据传输更快一些。但如果发送方把数据发送的过快，接收方就可能来不及接收，这就会造成数据的丢失。所谓流量控制就是让发送方的发送速率不要太快，要让接收方来得及接收。

16，在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏。这种情况就叫拥塞。拥塞控制就是为了防止过多的数据注入到网络中，这样就可以使网络中的路由器或链路不致过载。拥塞控制所要做的都有一个前提，就是网络能够承受现有的网络负荷。拥塞控制是一个全局性的过程，涉及到所有的主机，所有的路由器，以及与降低网络传输性能有关的所有因素。相反，流量控制往往是点对点通信量的控制，是个端到端的问题。流量控制所要做到的就是抑制发送端发送数据的速率，以便使接收端来得及接收。

17，为了进行拥塞控制，TCP发送方要维持一个拥塞窗口cwnd的状态变量。拥塞控制窗口的大小取决于网络的拥塞程度，并且动态变化。发送方让自己的发送窗口取为拥塞窗口和接收方的接受窗口中较小的一个。

18，TCP的拥塞控制采用了四种算法，即慢开始，拥塞避免，快重传和快恢复。在网络层也可以使路由器采用适当的分组丢弃策略(如主动队列管理AQM)，以减少网络拥塞的发生。

19，运输连接的三个阶段，即：连接建立，数据传送和连接释放。

20，主动发起TCP连接建立的应用进程叫做客户，而被动等待连接建立的应用进程叫做服务器。TCP连接采用三报文握手机制。服务器要确认用户的连接请求，然后客户要对服务器的确认进行确认。

21，TCP的连接释放采用四报文握手机制。任何一方都可以在数据传送结束后发出连接释放的通知，待对方确认后进入半关闭状态。当另一方也没有数据再发送时，则发送连接释放通知，对方确认后就完全关闭了TCP连接
###  最重要的知识点
#### ①端口和套接字的意义

#### ②无连接UDP的特点

#### ③面向连接TCP的特点

#### ④在不可靠的网络上实现可靠传输的工作原理，停止等待协议和ARQ协议

#### ①TCP的滑动窗口，流量控制，拥塞控制和连接管理

#### 该层协议共分为5类

|协议类|	网络类型|	  名称
|---:|-------:|-------------:|
| 0| A类|		简单类
|1 |	 B类|		基本错误恢复类
|2 |	  A类|  	多路复用类
 |3|	  B类|	差错恢复与多路复用类
|4|	  C类 |  	差错检测和恢复类

其中，网络类型的区别为  

			A型---具由可接受的残留差错率和失效通知率
			B型---具由可接受的残留差错率
			C型---两者都不可接受

##### TCP，传输控制协议
	TCP是TCP/IP中传输层采用的一种协议
	它从上层实体接受任意长度的报文，并为上层用户提供面向连接的，可靠的全双工数据传输服务。
	它是一种面向连接的协议，需要在一对高层实体间提供建立连接和释放连接的功能，连接方法是利用套接字。
	它适用于可靠或不可靠的网络。
##### UDP，用户数据报协议
	UDP是一种无连接的传输层协议，提供面向事务的简单不可靠信息传送服务。
	它不提供数据包分组、组装，不能对数据包进行排序。
	常用于支持那些需要在计算机之间传输数据的网络应用。
### OSI/RM模型---会话层---数据(data)
	

### 高层协议
	以下列举的应用、表示、会话层协议可供用(由于实际的网络协议将它们归了一类所致)
#### 具有会话层功能
	ADSP · ASP · H.245 · ISO-SP · iSNS · NetBIOS · PAP · RPC·
	
	RTCP · SMPP · SCP · SSH · ZIP · SDP
#### 会话层功能
	

会话层内的供能就是会话实体为了提供会话服务应执行的那些功能，这些功能必须由会话实体来完成。

1. 会话连接到传输连接的映射
2. 会话连接的流程控制
3. 加速数据传送
4. 会话连接的恢复
5. 会话连接释放
6. 会话连接管理
### OSI/RM模型---表示层---数据(data)
#### 具有表示层功能		
	HTTP/HTML · Telnet · ASN.1
### 表示层功能
	1.表示实体之间的连接建立、释放
	2.数据语法和图像语法的表示和转换
	3.传送语法的选择
	4.数据变换的特殊处理，如代码压缩 、密码转换等
### OSI/RM模型---应用层---数据(data)
#### 应用层协议
##### 文件传输协议---FTP
	它基于传输层为用户服务，负责进行文件的传输。它能操作任何类型的文件而不需要进一步的处理，但是有着极高的延迟	
##### 电子邮件协议---SMTP、POP3、IMAP4
###### SMTP协议，简单邮件传输协议。
	它是一组用于从源地址到目的地址传输邮件的规范，通过它来控制邮件的中转方式。
###### POP3协议，邮局协议的第三个版本
	它是因特网电子邮件的第一个离线协议标准。
###### IMAP4
	POP3的一种替代协议，添加了邮件检索与处理等新功能
##### 远程登录协议--- Telnet
	它是Internet远程登录服务的标准协议和主要方式。
	通过创建虚拟终端提供连接到远程终端的仿真，通过用户名和密码进行认证，为用户提供了在本地计算机上完成远程主机工作的能力。
##### 简单网络管理协议 --- SNMP、SNMP V2
其被采纳为基于TCP\IP的各种互联网络的管理标准。
它的核心思想就是，在每个网络节点上存放一个管理信息库(MIB)，由节点上的代理负责维护，管理者通过应用层协议对这些信息库进行管理。
它的最大特点就是**简单性** 
**SNMP标准**   由3部分组成:
  1. 简单网络管理协议---SNMP
  2. 管理信息结构---SMI
  3. 管理信息库---MIB

注:SMI和MIB 是两个关于管理信息标准的协议，它们规定了被管理的网络对象的定义格式，MIB中包含哪些对象，以及怎样访问这些对象等。SMI规定了定义个标识变量的一组原则，它规定**所有的MIB对象必须用ASN.1来定义**。

### 重要知识点总结
1，文件传输协议(FTP)使用TCP可靠的运输服务。FTP使用客户服务器方式。一个FTP服务器进程可以同时为多个用户提供服务。在进进行文件传输时，FTP的客户和服务器之间要先建立两个并行的TCP连接:控制连接和数据连接。实际用于传输文件的是数据连接。

2，万维网客户程序与服务器之间进行交互使用的协议时超文本传输协议HTTP。HTTP使用TCP连接进行可靠传输。但HTTP本身是无连接、无状态的。HTTP/1.1协议使用了持续连接(分为非流水线方式和流水线方式)

3，电子邮件把邮件发送到收件人使用的邮件服务器，并放在其中的收件人邮箱中，收件人可随时上网到自己使用的邮件服务器读取，相当于电子邮箱。

4，一个电子邮件系统有三个重要组成构件：用户代理、邮件服务器、邮件协议(包括邮件发送协议，如SMTP，和邮件读取协议，如POP3和IMAP)。用户代理和邮件服务器都要运行这些协议。



### 最重要知识点总结

#### ① 域名系统-从域名解析出IP地址
#### ② 访问一个网站大致的过程
#### ③ 系统调用和应用编程接口概念


## 局域网(LAN)
### 802.3 MAC帧格式

![](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/MAC%E5%B8%A7%E6%A0%BC%E5%BC%8F.png)

* 前导符：用来使接收方建立位同步。

* 帧首定界符(ＳＦＤ)：特定代码：“10101011”，表示一帧的开始。

* 目的地址(ＤＡ)：用来指示帧的接收站点。当最高位为“0”时表示单播地址;最高位为“1”时表示组播地址。

* 源地址(ＳＡ)：用来指示帧的发送站点。

* 数据长度：用来指示在数据和填充字段里数据的长度。(小于1500字节)

* 数据：LLC帧( LLC  PDU )。

* 填充(ＰＡＤ)：用来对数据进行填充，以保证帧长度不小于最小长度64字节。(保证发送一帧的时间大于两最远站点间发送冲突信号的时间的两倍)

* 帧校验序列(ＦＣＳ)：32位的循环冗余校验 ，用于检测帧是否有错 。

注意帧最大长度(1518B)和最小长度(64B)的作用。

### 802.3 物理层标准
IEEE802.3支持不同的物理层标准，而这些不同的物理层标准意味着传统以太网可以使用不同的传输媒体和物理层接口。

![](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/802.3%E7%89%A9%E7%90%86%E5%B1%82%E6%A0%87%E5%87%86.png)

#### 10-BaseT网络

![](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/10BaseT.png)

#### 100-BaseT网络

* 100BASE-T标准为IEEE 802.3u(1995年)。
* 采用与10Base-T相同LLC子层、帧格式及CSMA/CD媒体访问控制协议。
* 采用与10Base-T相同的星型拓扑结构，即所有快速以太网都是基于集线器的。
* 传输速率较10Base-T快10倍，即100 Mbps。
* 可采用UTP和光缆媒体。
* 快速以太网支持3种不同的物理层标准：100Base-T4、100Base-TX和100Base-FX。


### 总线竞争型媒体访问控制方法
总线型网常采用的是CSMA/CD协议，即带有冲突检测的载体侦听多路访问协议。它是一种采用随机访问技术的竞争型媒体访问控制方法，起源于ALOHA协议。
#### ALOHA协议
##### 纯ALOHA协议
- 当传输点有数据需要传送的时候，它会立即向通讯频道传送。

- 接收点在收到数据后，发送ACK帧(返回应答消息)回传输点。

- 如果接收的数据有错误，接收点会向传输点发送NACK。

- 当网络上的两个传输点同时向频道传输数据的时候，会发生冲突，这种情况下，两个点各自等待一段随机长度的时间后，再次尝试传送。
这种协议下，信道吞吐率很低
##### 分段ALOHA
这是对纯ALOHA协议的一个改进。改进之处在于，它把频道在时间上分段，每个传输点只能在一个分段的开始处进行传送。每次传送的数据必须少于或者等于一个频道的一个时间分段。这样大大的减少了传输频道的冲突。
	
##### 载体侦听多路访问/冲突检测,即CSMA/CD协议
###### CSMA/CD的物理含义
各站点在发送消息前，先侦听总线上是否有信息在传送。
若有，则不发，以免破坏传送;若没有，则发送。

多路访问，是指当一个站点发送信息时，其他站点使用各自的接收器收听(类似于广播)。
- 若目标地址是广播地址，则总线上所有站点都将接受信息并放在各自的缓冲区内以便处理;
- 若目标地址是某指定站点，则该指定站点将接受信息;
- 若目标地址是一个组地址，则该组地址都将接受信息;

	冲突检测，指当一个站点占用总线发送信息时，要一边发送一边检测总线，看是否有冲突产生。

	冲突的产生有两个原因:
	1.两个站点同时侦听到线路空闲，又同时发送信息导致冲突
	2.A站点刚发送信息还没有到达B站，B站此时检测到线路空闲，发送数据到总线上，导致冲突
###### CSMA/CD的特点
该协议采用竞争的方法强占对媒体的访问权利。
最小帧长为512位(64B)
优点:

	1. 结构简单
	
	2. 网络维护方便
	
	3. 增删节点容易
	
	4. 网络在轻负载情况下效率较高
	
缺点:

	1. 重负载情况下，冲突概率增加，性能明显下降
	
	2. 为了满足最小帧长的要求，额外添加的填充字段浪费了信道容量

## TCP/IP 网络通信协议
### TCP/IP的结构
TCP/IP包括四层协议:

1. 应用层，应用程序间沟通的层

2. 传输层，提供节点间的数据传送，应用程序之间的通信服务，主要功能是数据格式化，数据确认和丢失重传

3. 网络层，负责提供基本的数据封包传送功能

4. 网络接口层(主机-网络层)，接受IP数据报并进行传输，抽取IP数据报转交给下一层，是对实际的网络媒体的管理，定义如何使用实际网络来传送数据
### TCP/IP
TCP/IP是一组协议的代名词，它还包括其他一些协议。

	TCP --- 传输层协议，负责流量控制和校验正确性
	IP  --- 网络层协议，负责传输数据

在TCP/IP协议中，除了TCP和IP外，还有:
- ARP，地址解析协议,此协议将网络地址映射到硬件地址，属于网络层协议
- RARP，反向地址解析协议，此协议将硬件地址映射到网络地址，属于网络层协议
- ICMP，网间报文控制协议，属于网络层协议
- UDP，用户数据报协议，提供无连接服务，属于传输层协议
- FTP，文件传输协议，允许用户以文件操作的方式与另一台主机相互通信，属于应用层协议
- SMTP，简单邮件传输协议，属于应用层协议
- Telnet，远程登陆协议，属于应用层协议
- TFTP，简单文件传输协议，属于应用层协议
- DNS，域名系统，属于应用层协议

![](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/TCP.IP%E4%B8%AD%E7%9A%84%E5%8D%8F%E8%AE%AE%E7%BD%91%E7%BB%9C.png)

### 网络层协议
网络层协议的主要功能是实现互联网络环境下的数据分组传输
这些功能主要由4个协议实现:
	IP ，ARP ，RARP ，ICMP
	
	IP --- 提供数据分组传输、路由选择等功能;
	ARP、RARP --- 提供逻辑地址与物理地址映射的功能
	ICMP --- 提供网络控制和差错处理功能
#### IPv4,即IP
	IP，提供无连接的数据报传输机制，IP数据报的格式与一般帧类似，分为报头和数据区两个部分
##### IP数据报格式
	格式如下图:
![IP数据报格式](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F.png)

- 版本:IP协议的版本，目前的IP协议版本号为4，下一代IP协议版本号为6。


- 首部长度:IP报头的长度。固定部分的长度(20字节)和可变部分的长度之和。共占4位。最大为1111，即10进制的15，代表IP报头的最大长度可以为15个32bits(4字节)，也就是最长可为15*4=60字节，除去固定部分的长度20字节，可变部分的长度最大为40字节。
	
- 服务类型:Type Of Service。


- **总长度**:IP报文的总长度。报头的长度和数据部分的长度之和。
	

- **标识**:唯一的标识主机发送的每一分数据报。通常每发送一个报文，它的值加一。当IP报文长度超过传输网络的**MTU**(最大传输单元)时必须分片，这个标识字段的值被复制到所有数据分片的标识字段中，使得这些分片在达到最终目的地时可以依照标识字段的内容重新组成原先的数据。


- **标志**:共3位。R、DF、MF三位。目前只有后两位有效，DF位:为1表示不分片，为0表示分片。MF:为1表示“更多的片”，为0表示这是最后一片。


- **分段(片)位移**:本分片在原先数据报文中相对首位的偏移位。(需要再乘以8)

- 生存时间:IP报文所允许通过的路由器的最大数量。每经过一个路由器，TTL减1，当为0时，路由器将该数据报丢弃。TTL 字段是由发送端初始设置一个 8 bit字段.推荐的初始值由分配数字 RFC 指定，当前值为 64。发送 ICMP 回显应答时经常把 TTL 设为最大值 255。

- 协议:指出IP报文携带的数据使用的是那种协议，以便目的主机的IP层能知道要将数据报上交到哪个进程(不同的协议有专门不同的进程处理)。和端口号类似，此处采用协议号，TCP的协议号为6，UDP的协议号为17。ICMP的协议号为1，IGMP的协议号为2.

- 首部校验和:计算IP头部的校验和，检查IP报头的完整性。

- 源IP地址:标识IP数据报的源端设备。
	
- 目的IP地址:标识IP数据报的目的地址。

- 可选字段:用以指定额外服务

##### 数据报的分段与重装

1. 分段，为了适应不同物理网络的信息传输，IP将对上层协议提交的协议根据物理网络允许的最大帧长进行检查，必要时会分段发送。
	分段时每一段都要加上IP报头，形成IP数据报(与分段有关的报头字段有，标识，报文长度，分段位移，标志)

2. 重装，被分段的数据报在到达目标主机前可能经过不同路由器，导致到达顺序与发送时不同，因此IP必须根据报头中的相关字段重组数据报再提交给上层协议

##### 数据报的发送和接受
1. 发送。
	* 若上层协议已指定发送路由，则按指定路由发送数据报;
	+ 若上层协议未指定发送路由，则以报头中指定的IP地址为关键字来搜索路由表中的路由。若未找到，则说明不可达，向上层协议返回错误信息;
			- 若直接可达，则将路由表中的目的IP地址告知给网络接口程序;
			- 若不直接可达，则将路由表中对应的路由器IP地址通告给网络接口程序。
2. 接受。当IP接收到由网络接口程序传来的数据报时
	* 若接受节点为主机节点，则比较目报头中的目的地址与本机地址是否匹配，匹配则向上递交，否则丢弃。
	* 若接受节点为路由器节点，则需要转发该数据报，即用数据报的目的IP地址从路由表中查找转发路由，若找到就按该路由转发，否则向源主机发送ICMP报文，报告目的不可达。	
	
#### IP地址
  IP地址为32位二进制，由网络标识和主机标识组成。
  组成通常为:M(地址类别号)+网络号(netID)+主机号(hostId)

![上图为A类IP地址](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/A%E7%B1%BB%E5%9C%B0%E5%9D%80.png)

![上图为B类IP地址](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/B%E7%B1%BB%E5%9C%B0%E5%9D%80%E6%A0%BC%E5%BC%8F.png)

![上图为C类IP地址](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/C%E7%B1%BB%E5%9C%B0%E5%9D%80%E6%A0%BC%E5%BC%8F.png)

##### IP地址中的一些特殊规定
* 全 0 时表示主机，只允许主机启动时使用
* 全 1 表示在该网的广播地址，常用于初始化
* 127.0.0.1表示回送地址，以此为目标地址的数据报将被IP立即送回，常用于测试网络。
* 主机全为0，表示该IP为某网络的网络地址
* 主机全为1，表示该网络的广播地址，若向该网络内的所有主机广播时，它是目标地址。
##### A,B,C,D,E类地址
	A类地址范围是:0.0.0.0 -- 127.255.255.255
	B类地址范围是:128.0.0.0 -- 191.255.255.255
	C类地址范围是: 192.0.0.0 -- 223.255.255.255
	D类地址范围是:224.0.0.0 -- 239.255.255.255
	E类地址范围是:240.0.0.0 -- 255.255.255.255
###### 各类地址区别
1. A类地址通常用于超大型网络
2. B类地址通常用于大型网络，适用于国际性大公司、政府等
3. C类地址校园网、企业网等
4. D类地址是多播地址

	Internet中允许有两类广播组:
	* 临时地址广播组，必须事先创建;
	 永久地址广播组，不需要事先创建，常用于特殊目的
		- 224.0.0.1表示本网络所有主机和路由器
		- 224.0.0.2表示本网络所有的路由器
		- 224.0.0.5表示本网络所有的OSPF路由器
		- 224.0.0.6表示本网络指定的OSPF路由器
		- 224.0.0.9表示本网络所有的RIP路由器
			
5. E类地址是实验地址，保留用于研究，Internet上没有可用的E类地址
##### 私有地址(下列地址不可使用)
	A类:10.0.0.0 -- 10.255.255.255
	B类:172.16.0.0 -- 172.31.255.255
	C类:192.168.0.0 -- 192.168.255.255

### ARP和RARP
  RAP，地址解析协议，功能实是提供从IP地址到物理地址映像服务;
  RARP，逆向地址解析协议，功能是提供从物理地址到IP地址映像服务;
IP地址与物理地址之间的映射称为地址解析。
	目的:通过网络层将物理层隐藏起来，使TCP/IP与具体的物理网络无关。

#### ARP
ARP使在仅知道主机的IP地址的情况下确认其物理地址的一种协议
	ARP主要负责将32位的IP地址转换位48位的MAC地址(网卡上的MAC地址)
	
**转换过程**
1. 一台主机向目标主机发送包含IP地址信息的而广播报数据，即ARP请求
2. 目标主机向该主机发送一个含有IP地址和MAC地址的数据报
3. 通过MAC地址两个主机就能实现数据传输

假设有A，B两个主机，在TCP/IP中，A主机若要向B主机发送IP包，就需要在报头中填写B主机的IP地址，而这个IP包在以太网上传输时，还需要进行一次以太帧封装，在这个以太帧中，目标地址就是B主机的MAC地址。而A主机得知B主机MAC地址，靠的就是ARP协议。

具体步骤如下:
	1. A在不知道B的MAC地址的情况下，广播一个ARP请求，请求包中填上B的IP地址
	2. 尽管以太网中的所有主机都会收到这一请求，但由于指定了IP地址，所以只有B主机会给出ARP应答包，其中就包含了B主机的MAC地址
	3. A得到ARP应答包后，将B的MAC地址放入本机缓存以便后用。本机MAC缓存是由生存期的，生存期结束后，A将回到初始状态(即未知B的MAC地址)并重复以上过程

注:局域网的网络流通不是根据IP地址进行的，而是根据MAC地址进行传输。一个IP包的流向是由路由表定义的，而IP包到达一个网段后，哪台机器来响应这个IP包，靠的是该IP包中包含的MAC地址。

##### ARP映射表
主机或交换机用于缓存同一网段设备IP地址和MAC地址的地方——ARP映射表，用于数据帧的转发。ARP表项分为动态ARP表项和静态ARP表项

##### 动态ARP表项
动态ARP表项由ARP协议通过ARP报文自动生成和维护，可以被老化，可以被新的ARP报文更新，可以被静态ARP表项覆盖。
当到达老化时间或接口关闭时，相应的动态ARP表项会被删除。
##### 静态ARP表项
静态ARP表项通过手工配置和维护。不会被老化，不会被动态ARP表项覆盖。
配置静态ARP表项可以增加通信的安全性，因为静态ARP可以限定和指定IP地址的设备通讯时只使用指定的MAC地址
此时ARP欺骗攻击无法修改此表项的IP地址和MAC地址的映射关系，从而达到保护本设备和制定设备的正常通信。
静态ARP表项又分为短静态ARO表项和长ARP静态表项。
 					
##### ARP欺骗
ARP欺骗分为两种:同网段ARP欺骗和不同网段ARP欺骗

###### 同网段的ARP欺骗，举个例子

	有三台主机A，B，C。他们的IP地址和MAC地址分别如下所示:
	A:IP地址 192.168.0.1	MAC地址 AA:AA:AA:AA:AA:AA
	B:IP地址 192.168.0.2	MAC地址 BB:BB:BB:BB:BB:BB
	C:IP地址 192.168.0.3	MAC地址 CC:CC:CC:CC:CC:CC


如果一个位于主机B的用户想要非法入侵主机A，而主机A的防火墙只对主机C有信任关系(开放23端口(Telnet))，而他必须用Telnet进入主机A，此时应该如何处理？

  如果仅将主机B的IP地址改成主机C的IP地址，那么会与主机C形成一个竞争关系，如果此时你用其他手段使主机C宕机，那么也可以行得通，但这种方法不可靠，无法有效达成目标。
   
  但是，如果A和C的信任关系是建立在硬件地址基础上的，那么上面的方法就毫无用处了。这个时候就需要用ARP欺骗，让A主动把ARP缓存中关于192.168.0.3(C的IP地址)映射的硬件地址改为主机B的硬件地址。
  
  由于协议并没有规定必须发送请求包才能接受应答包，即可以**伪造一个arp_reply响应包**，就可以**人为指定ARP包中的(源、目标)IP地址和(源、目标)MAC地址**，从而可以达到修改A主机ARP缓存中映射表的目的。
###### 不同网段的ARP欺骗

	有三台主机A，B，C。他们的IP地址和MAC地址分别如下所示:
	A:IP地址 192.168.0.1	MAC地址 AA:AA:AA:AA:AA:AA
	B:IP地址 192.168.１.2	MAC地址 BB:BB:BB:BB:BB:BB
	C:IP地址 192.168.0.3	MAC地址 CC:CC:CC:CC:CC:CC
	
  这种情况与上一种情况最大的区别就是，即使欺骗成功，B和A也无法建立Telnet对话，因为路由器无法把A发送给B的包向外转发，路由器会发现地址在	192.168.0网段内
	
  该情况下，就需要另一种技术——ICMP重定向。将**ARP欺骗和ICMP重定向**相结合就可以达到目的。
	
ICMP重定向的定义
	ICMP重定向报文是ICMP控制报文的一种。该功能提供了一种路由优化控制机制，使源主机能以动态方式寻址最短路径。
	也就是说在特定情况下，当路由器检测到一台机器使用非优化路由的时候，它会向该主机发送一个ICMP重定向报文，请求主机改变路由。
	路由器也会把初始数据报向他的目的地转发。
	
下面是结合两种技术进行攻击的步骤:
	
1. 首先为了让自己的非法IP包存活的够久，要修改ip包的生存时间ttl，改长一点有利于做充足的广播
	
2. 寻找漏洞并利用漏洞当掉主机C
	
3. 在该网络的主机找不到原来的192.168.0.3后将更新自己的ARP映射表。
	此时人为发送一个ip地址位192.168.0.3，硬件地址为 BB:BB:BB:BB:BB:BB 的响应包。
	
4. 现在每台主机都知道192.168.0.3对应B主机的硬件地址了，一个ARP欺骗就完成了。
	但每个主机都只会在局域网中找这个地址而根本就不会把发送给192.168.0.3的IP包丢给路由器。所以接下来要继续构造一个ICMP重定向广播
	
5. 自己定制一个ICMP重定向包来告诉网络中的主机，
	“到192.168.0.3的路由最短路径不是局域网而是路由，请重定向路由路径，把所有发送给192.168.0.3的ip包丢给路由”
	
6. 主机A接收到这个合理的ICMP重定向，于是修改自己的路径，把相应的ip包都丢给路由
	
7. 入侵者可以在路由外收到来自路由内的主机ip包了，他可以开始telnet到主机的23口了。

注:23端口主要用于Telnet(远程登陆)服务

##### ARP报文格式

![ARP报文格式](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/arp%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.png)

	·硬件类型:占两字节，表示ARP报文可以在哪种类型的网络上传输，值为1时表示为以太网地址。

	·上层协议类型:占两字节，表示硬件地址要映射的协议地址类型，映射IP地址时的值为0x0800。

	·MAC地址长度:占一字节，标识MAC地址长度，以字节为单位，此处为6。

	·IP协议地址长度:占一字节，标识IP得知长度，以字节为单位，此处为4。

	·操作类型:占2字节，指定本次ARP报文类型。1标识ARP请求报文，2标识ARP应答报文。

	·源MAC地址:占6字节，标识发送设备的硬件地址。

	·源IP地址:占4字节，标识发送方设备的IP地址。

	·目的MAC地址:占6字节，表示接收方设备的硬件地址，在请求报文中该字段值全为0，
		即00-00-00-00-00-00，表示任意地址，因为现在不知道这个MAC地址。

	·目的IP地址:占4字节，表示接受方的IP地址。

  由于ARP报文不是直接在网络层上发送的，它还需要向下传输到数据链路层，所以当ARP报文传输到数据链路层之后，需要再次进行封装。
  以以太网为例，ARP报文传输到以太网数据链路层后会形成ARP帧，格式如下图，就是在ARP报文前面加了一个以太网帧头

![ARP帧格式](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/ARP%E5%B8%A7%E6%A0%BC%E5%BC%8F.png)

以太网帧头的三个字段说明

	·目的MAC地址:占6字节，如果是ARP请求帧，因为它是一个广播帧，所以要填上广播MAC地址(FF-FF-FF-FF-FF-FF)，其目标主机是网络上的所有主机。

	·源MAC地址:占6字节，这是发送ARP帧的节点MAC地址。

	·帧类型:占两字节，这里用来标识帧封装的上层协议，因为本帧的数据部分是ARP报文，所以直接用ARP的协议号0x0806表示就可以了。

#### RARP

  如果一个主机初始化后只有自己的MAC地址而没有IP地址，就可以通过RARP协议发送广播式请求报文来获取自己的ip，RARP服务器负责对该请求做出应答。
  常用于无盘工作站来获取自己的IP地址
#### ICMP
  ICMP,因特网控制报文协议，是IP的一部分，必须包含在每一个IP中。
  ICMP数据报要通过IP发送出去，它有多种类型，可以提供多种服务。
  虽然ICMP由IP数据报传输，但并不把ICMP看作比IP更高层的协议。所以ICMP作为一个独立的协议，仅作为IP中的一个模块，来处理IP层中的控制问题。

　ICMP报文分为两种:
	1.ICMP差错报文
	2.ICMP控制报文

##### ICMP报文格式

![ICMP报文格式](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/ICMP%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.jpg)



**ICMP类型值与报文类型**

|TYPE	 |ICMP报文类型 	|
|-----:|----------:	|
| 0	 | 回送响应	|
| 3	 | 目的不可达	|
| 4	 | 报源抑制	|
| 5	 | 重定向	|
| 8	 | 回送请求	|
| 11	 | 数据报超时	|
| 12	 | 数据报参数错	|
| 13	 | 时戳请求	|
| 14	 | 时戳响应	|
| 17	 | 屏蔽码请求	|
| 18	 | 屏蔽码响应	|

**代码域及意义**

|代码域	| 意义				|
|----:|---------------------------: |
| 0	| 网络不可达			|
| 1	| 主机不可达			|
| 2	| 协议不可达			|
| 3	| 端口不可达			|
| 4	| 需分段但标志禁止分段		|
| 5	| 源选址失败			|
| 6	| 目标网络未知			|
| 7	| 目标主机未知			|
| 8	| 源主机被隔离			|
| 9	| 禁止与目标网络通信		|
| 10	| 禁止与目标主机通信		|
| 11	| 对请求的服务类型，网络不可达	|
| 12 	| 对请求的服务类型，主机不可达	|

##### ICMP差错报文
  ICMP的基本功能就是提供差错报告传输机制。对于差错的处理方式，ICMP没有规定的处理方式。源主机在收到ICMP差错报文后，还需要与应用程序联系起来，才能决定相应的差错处理方式。
  ICMP的差错报告都是采用路由向源主机报告的模式，即当路由器发现IP数据报差错后，使用ICMP报文向该IP数据报的源主机报告其差错，同时丢弃出现差错的报文。
  
在ICMP差错报文中，共有三种报文，分别是:

- 目的不可达报文   当路由表上查询不到该IP数据报的目标IP地址对应的路由器时，会发生目的不可达错误，此时路由器会回送一个该报文给源主机。
	目的不可达报文类型为3，并进一步细分成13种子类，用代码来标识，其他信息字段未用，为全0
	
- 超时报文   如果在某个路由器上，数据报的生存时间减为了0，则该路由器会丢弃这个数据报，并向源主机发送Type=11,Code=0的ICMP报文。
	当目的主机在对数据报进行重装的过程中发生重装超时时，将丢弃已收到的各个分段数据报，并在第一个分段数据报到达后，回送Type=11,Code=1的报文
	
- 参数出错报文   当路由器或目的主机在对收到的IP数据报进行处理时，若发现在IP报头参数中含有无法继续完成报文处理的错误，
	则将该数据报丢弃，并回送Type=12,Code=0的ICMP报文，并且在ICMP报文的其他信息字段中用1B作为指针来指出差错在数据报中的位置

##### ICMP控制报文
  ICMP控制报文主要用于**拥塞控制**和**路由控制**
  
- 报源抑制报文   当数据报输入路由器的速度大于路由器的转发速度时，可能会发生拥塞现象。拥塞控制与流量控制最大的不同在于，流量控制是解决端到端的传输速率匹配问题，是局部控制;而拥塞控制带有全局性质，因为拥塞现象可能会影响到整个网络的数据传输，所以需要各个节点共同参与协同解决。
- 重定向报文   该功能提供了一种路由优化控制机制，使源主机能以动态方式寻址最短路径。

     重定向报文类型为5，分为4个子类:
	
	* Code=0表示网络重定向数据报
	* Code=1表示主机重定向数据报
	* Code=2表示服务类型和网络重定向数据报
	* Code=3表示服务类型和主机重定向数据报

	在重定向报文的其他信息字段中要填入重定向的路由IP地址
	
##### ICMP请求/应答报文
+ 回送请求与响应报文
	- 回送请求与响应报文主要用于测试网络目的节点的可达性
+ 时戳请求与响应报文
	时戳请求与响应报文主要用于估算源节点和目的节点间的报文往返时间，报文中使用了3个时戳字段
	- 初始时戳  源节点发送时戳请求报文的时间
	- 接受时戳  目的节点接收到时戳请求报文的时间
	- 发送时戳  目的节点发送时戳响应报文的时间
+ 屏蔽码请求与响应报文
	- 主要用于源节点获取所在网络的IP地址屏蔽码信息。

### 传输层协议

#### 传输层端口
  传输层的功能之一就是提供了**面向进程的通信机制**。因此，传输层协议必须提供某种方法来标识进程。TCP/UDP通过**端口(Port)来标识进程**，端口相当于OSI传输层的服务访问点(TSAP)，它是一种抽象的软件结构，内部包含一些数据结构和I/O缓冲区。进程通过系统调用与某个或某些端口建立联系后，就可以使用相应的端口传输信息了。
  TCP和UDP的端口值都是16位，分别可以提供2^16个不同端口。
  TCP和UDP将端口分为两部分:
  
1. 保留端口，占全部端口的一小部分，以全局方式分配，又叫"周知"端口
2. 自由端口，占全部端口的绝大部分，以本地方式分配

  当一个进程与另一个进程通信之前，该进程首先申请一个本地自由端口，然后由已知的远地端口(“周知”端口或自由端口)与远地进程建立联系并进行数据传输
##### TCP常用端口分配表

|应用|端口|应用层协议|传输层协议|备注
|---------------:|:-----:|:------:|:----:|:------------:|
|动态主机配置协议|67/68|DHCP|UDP|
|简单网络管理协议|161/162|SNMP|UDP|
|域名解析协议|53|DNS|UDP/TCP|长度超过512，则使用TCP
|文件传输协议|20/21|FTP|TCP|控制连接是20，数据连接是21
|远程终端协议|23|TELNET|TCP|
|超文本协议|80|HTTP|TCP|
|简单邮件传输协议|25|SMTP|TCP|
|邮件读取协议|110|POP3|TCP|
|网际报文存取协议|143|IMAP|TCP|

##### UDP常用端口分配表
|端口号	| 关键字	| 服务说明		|	
|:----: |-------:	|-------------:	|
| 53	| DOMAIN	| 区域名字服务器	|
| 520	| RIP		| 路由协议		|
| 4000	| QQ		| QQ协议		|

#### TCP
  TCP提供面向连接的可靠字节流服务，即传输数据前必须先在两个不同的传输端口之间建立一条链路，一旦连接成功，两个进程间就会建立起一条虚电路，发送进程向他输入数据，接受进程从它依次取出数据。
  TCP的连接服务提供**全双工**方式，由两个方向相反的独立通道组成，可以同时向两个相反方向发送数据字节流。
  TCP由很大的独立性，它对下层网络协议只有基本的要求，很容易在不同的网络上应用。它对高层的数据结构无任何要求，只将它们作为一种连续的数据流，所以可以支持许多高层协议(ULP)。

##### 滑窗协议
  该协议被TCP用于流量控制，类似场景有

         你:你一次最多报 4 个数字，多了我记不住啊！
         Luffy:139
         你:139 (Luffy 知道你听到了)
         Luffy:7548
         你:7538 (很明显你听错了)
         Luffy:不对，是7548
         你:7548
         Luffy 2669
         你:2669
 最终你接收到的序列为139-7548-2669
 TCP报文格式如图所示:

 ![](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/TCP%20%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.png)

 比如，你给对方发送了一个段携带字节序号为 [400, 500) 的数据。对方回送了一个 TCP 段，ack = 500, win = 100，就表示，
 我已经收到 [400, 500) 的数据我还能接收字节序号为 [500, 600) 之间的数据，如下图所示

 ![](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A31.png)

 对方回送 0 大小的窗口，接收端的反应如下

 ![](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A32.png)


##### TCP报文格式

|报头字段名|位数|说明|
|--------:|--:|--------------------:|
| 源端口号|16|本地通信端口，支持TCP的多路复用机制|
|目的端口号|16|远地通信端口，支持TCP的多路复用机制|
|序号(seq)|32|数据段第一个数据字节的序号|
|确认号(ack)|32|SYN段的SYN序号(建立本次连接的初始序号)|
|报头长度|4|如果报头没有TCP选项字段，则报头长度值位5|
|控制字段:
|·URG|1|表示该段中带有紧急数据|
|·ACK|1|确认号字段有效的标志
|·PSH|1|PUSH操作的标志
|☆RST|1|要求中止通信连接的标志
|★SYN|1|请求建立连接的标志
|☆FIN|1|请求终止连接的标志
|窗口|16|表示本地接受窗口尺寸，即本地接收缓冲区大小
|校验和|16|包括TCP报头和数据在内的校验和
|紧急指针|16|从段序号开始的正向位移，指向紧急数据的最后1B
|选项|可变|提供任选的服务
|填充|可变|保证TCP报头以32位为边界对应

 ---
  TCP中的基本传输单元为段(Segment)，一个TCP段由段头和数据流两部分组成。由于TCP数据流是一个无结构字节流，无任何可供解释的结构，所以TCP段的长度是**可变**的。因此，TCP中的序号和确认号都是针对**字节流中的字节**而不是段的。

##### 紧急传输机制

在TCP提供的字节流传输服务中，总是先进入缓冲区的字节首先被传输，并抢先抵达接收端。而为了处理一些紧急传输，这就用到了URG位。

当URG位置1时，就表示此段TCP报文中有紧急数据，该数据的起始位置由紧急指针域表示。
接收端收到这种报文时将首先对它进行处理或递交给应用程序。因此，URG相当于一般传输协议中的加速数据传输或带外数据传输的功能。

为了保证传输的可靠性，接收方将确认已正确收到的连续字节流**前n字节**，给出的确认号指示的是**下一个(n+1)**所希望接收到的字节。

##### 建立连接-三次握手

![三次握手](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png)

1. B首先处于LISTEN状态，等待客户的连接请求
2. A向B发送链接请求报文段，SYN=1，ACK=0，选择一个初始序号seq=x
3. B收到连接请求报文段，如果同意建立连接，则向A发送链接确认报文段,SYN=1，ACK=1，确认号ack=x+1，同时也选择一个初始的序号seq=y
4. A收到B的连接确认报文段后，还要向B发出确认，确认号ack=y+1，序号seq=x+1
5. B收到A的确认后，连接建立

* 第一次消息发送中，A随机选取一个序列号作为自己的初始序号发送给B;
* 第二次消息B使用ack对A的数据报进行确认，因为已经收到了序列号位x的数据报，准备接受序列号为x+1的包，所以ack=x+1，同时B告诉A自己的初始序列号,就是seq=q
* 第三条消息A告诉B收到了B的确认消息并准备建立连接，A自己此条消息的序列号时x+1,所以seq=x+1，而ack=y+1表示A正准备接受B序列号为y+1的数据报。

![第三次握手的用处](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/%E7%AC%AC%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E7%9A%84%E7%94%A8%E5%A4%84.png)

##### 关闭连接-四次挥手
由于TCP连接是全双工的，因此每个方向要**单独**关闭。这一原则是当一方完成数据发送任务后，发送一个FIN来终止这一方向的连接

收到一个FIN只是表示**这一方向**上没有数据流动了，即不会再收到数据了，但是这个TCP连接上任然能够发送数据，知道这一方向也发送了FIN。

![四次挥手](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.png)

* 第一次挥手:客户端发送一个FIN，用来关闭客户端到服务器的数据传送，客户端进入   FIN_Wait_1状态
* 第二次挥手:服务器收到FIN后，发送一个ACK给客户端，确认序号为收到序号+ 1(与SYN相同，一个FIN占用一个序号)，服务器进入CLOSE_WAIT状态
* 第三次挥手:服务器发送一个FIN，用来关闭服务器到客户端的数据传送，服务器进入LAST_ACK状态
* 第四次挥手:客户端收到FIN后，客户端进入TIME_WAIT状态，接着发送一个ACK给服务器，确认序号为收到序号+1，服务器进入CLOSED状态，至此，完成四次挥手。

注:
1. 为什么建立连接是三次握手，而关闭连接确实四次挥手呢？

	因为建立连接时，服务器端在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN在同一个报文中发送给客户端。
	而关闭连接时，一旦收到对方的FIN报文，仅表示对方不会再发送数据过来了，但仍然可以接受数据，己方也未必已经把数据全部发送给对方了。
	所以己方可以立即CLOSE，也可以发送一些数据给对方后再发送FIN给对方表示同意关闭连接。因此，己方ACK和FIN一般都会分开发送。

2. **为什么TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能回到CLOSE状态？**
	* 不应该是为了防止B发送的FIN=1的包丢失，因为如果A没有收到来自B的释放连接请求，是不会进入TIME_WAIT状态的。
	* 正确的解释是:防止A发送的确认释放连接信息B没有收到，此时B会再次发送一个FIN=1的释放连接请求，而这个时候A还处于TIME_WAIT，所以可以再次发送确认信息。

##### 流量控制
  TCP采用一种称为信用证的动态窗口机制，主要通过TCP段中的"窗口"字段和"确认号"字段实现
"窗口"字段对应于TCP实体能够接受的数据的序号空间，**"确认号"表示TCP实体希望接受的下一个数据字节的序号**。

#### UDP
UDP提供的是一种面向无连接的传输服务，这种服务
* 不确认报文是否到达
* 不对报文排序
* 不进行流量控制

与TCP相同，UDP通过端口号支持多路复用机制，ULP可以通过端口地址共享单一的UDP实体

由于UDP功能少，所以它是一种简单的协议机制，通信开销小，效率比较高，适合多媒体通信等需求快捷、低延迟通信，且对可靠性要求不高的场合

#### DNS协议---应用层协议
域名系统，由于IP难以理解记忆而出现。
* 每一个IP网的主机或网关都有相应的域名。
* 一个主机域名唯一确定一个IP地址，一个IP地址对应若干域名

域名通常采用的层次结构是:

	···.次次高层.次高层.最高层

最右边的部分是顶级域名(TLD)，左边一个是二级域名(SLD)，再左边一个是三级域名，每一级域名控制它下一级域名的分配。
##### 通用顶级域名

| 域名| 适用范围|
|------:|------------------------------:|
|☆.com|供商业机构使用|
|☆.net|供网络服务供应商使用|
|☆.org|供不属于其他通用顶级域类别的组织使用|
|☆.info|供资讯性网站使用，但无限制
|☆.xyz|无限制
|.mil|供军事机构使用|
|.gov|供政府及其属下机构使用|
|.edu|供教育机构使用|
|.biz|供商业使用|
|.name|供家庭及个人使用|
|.pro|供部分专业使用|
|.aero|供航空运输业使用|
|.asia|供亚太地区的公司、组织及个人使用|
|.cat|供加泰罗尼亚语/文化使用|
|.coop|供联合会 (cooperatives)使用|
|.int|供由条约而成立的国际性机构使用|
.jobs|供求职相关网站使用
.mil|供美国军事机构使用
.mobi|供手提电话等装置网站使用
.museum|供博物馆使用
.post|供邮政服务使用
.tel|供连接电话网络与互联网的服务使用
.travel|供旅行社、航空公司、酒店及旅游协会等机构使用
.xxx|供色情网站使用

注:☆标注的是通用顶级域名，其余的部分为限制或赞助部分

#### HTTP---应用层协议
万维网(WWW)是Internet中最受欢迎的一种多媒体信息服务系统。

整个系统由Web服务器、浏览器和通信协议等三部分组成，其中通信协议采用的是HTTP(超文本传输协议)。

HTTP是专门为Web服务系统设计的**应用层协议**，能够传送任意类型数据对象。

在Web系统中，使用了一种简单的命名机制:URL,即统一资源定位器，来唯一地标识和定位Internet中的资源。它由三部分组成:
* 客户与服务器之间所使用的通信协议
* 存放信息的服务器地址
* 存放信息的路径和文件名

URL不仅可以描述Web服务器资源，还可以描述其他服务器资源，如Telnet、FTP、Gopher、WAIS、Usenet等

## 网络设备与网络互连

### 网络互连的不同层次和相应设备

![网络互连的不同层次和相应设备](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/%E7%BD%91%E7%BB%9C%E4%BA%92%E8%BF%9E%E7%9A%84%E4%B8%8D%E5%90%8C%E5%B1%82%E6%AC%A1%E5%92%8C%E7%9B%B8%E5%BA%94%E8%AE%BE%E5%A4%87.png)

### 广播域和冲突域

![广播域和冲突域](https://raw.githubusercontent.com/CICSilver/leetCode/master/pic/%E5%B9%BF%E6%92%AD%E5%9F%9F%E5%92%8C%E5%86%B2%E7%AA%81%E5%9F%9F.png)

### 路由器---工作在网络层
路由有两层含义:
* 路径，数据报发送通过的路径
* 数据包发送的路径选择过程
表示源地点和目的地的是IP地址，所以路由的过程就是将不同IP地址网段的IP包进行转发。

#### 路由器的功能与特点
路由器运行在OSI模型的**网络层**，核心功能是**在多个网络之间选择最佳路由**，以转发报文分组。

路由器将互联网络分为多个逻辑网络，每个逻辑网络都是一个独立的广播域。这与网桥有着本质的区别。

路由器具由以下特点:
1. 路由器支持各种网络互连协议，具由判断网络地址和选择路径的功能，各子网使用的硬件设备对路由而言是透明的，但要求各子网运行**相同的网络层协议**

2. 路由拥有最佳路由选择能力。路由器支持多种路由协议，可动态生成路由表。
目前路由器使用的路由协议包括**最短路径优先协议(OSPF)**，**边界网关协议(BGP)**,**内部网关路由协议(IGRP)**

3. 路由器可动态过滤网络信息，拒绝恶意数据访问，有利于网络的安全保密。路由器转发和过滤数据的速度**往往**比只查看数据物理地址的交换机慢。

4. 路由器有更强的**隔离能力**，可有效隔离局域网的广播，组织广播风暴传播到整个互联网络

5. 路由器拥有较好的**拥塞控制**能力，可均衡负载，进行**流量控制**

6. 路由器适合连接大型网络，异种网络互连与多个子网互连一般应采用路由器连接。

##### 路由器的分类
1. 模块化路由器   指接口类型和部分扩展功能可以根据用户的实际需求来配置的路由器，目前多数路由器都是模块化路由器

2. 非模块化路由器 基本是一些低端路由器产品，主要用于连接家庭或互联网服务提供商内的小型企业客户

3. 核心路由器     又称为骨干路由器，是位于网络中心的路由器。性能相对较高，一般完成网络干线的节点连接。某一层的核心路由器是另一层的边缘路由器

4. 多WAN路由器    其中的双WAN路由器具有物理上的两个WAN口作为外网接入，这样内网可以经过路由器的负载均衡功能同时使用两条外网接入线路，大幅提高了网络带宽

5. 无线网络路由器 是一种用来连接有线和无线网络的通信设备，它可以通过WiFi技术收发无线信号。在这种路由器的功率范围内，安装移动网卡的设备可以方便地建立一个网络。

##### 路由器的结构

路由器具有4个要素:

* 输入端口   端口通常由线路卡提供，一块线路卡一般支持4、6或8个端口，一个输入端口具有许多功能:
   - 对数据按数据链路层协议进行帧的封装和解封
   - 对路由的查找功能，一旦查找完成，必须用交换结构将包送到其输出端口

* 交换结构   连接输入端口、输出端口和路由处理器，以便把输入端口的数据报交换到一个或多个输出端口或路由处理器

* 路由处理器 根据路由协议生成和维护路由表，运行路由器配置和管理的软件，处理那些目的地址不在路由表中的数据报

* 输出端口   支持对数据按数据链路层协议进行的帧的封装和解封操作，对将要发送出去的数据进行存储操作，可实现复杂的调度算法以实现对优先级的支持。

##### 路由表的产生方式

产生路由表的途径有以下几种方式:
1. 直连路由   由数据链路层发现，一般指去往路由器的端口地址所在网段的路径。直连路由无法使路由器获取与其不是直接相连的路由信息

2. 静态路由   人为根据网络拓扑结构输入路由条目

3. 动态路由   通过动态路由算法学习得到的路由。在大型网络环境下，依靠OSPF、BGP、RIP等路由协议来学习路由。
##### 泛洪(Flooding)
 这个概念在链路状态路由选择协议中出现。

 链路状态路由器向它们的邻居发送呼叫消息，这称为链路状态数据报(LSP)或链路状态通告(LSA)，
 然后邻居将LSP复制到它们的路由表中，并传递那个信息到网络的剩余部分，这个过程就称之为，泛洪。

 它的结果是向网络中发送即时信息，为网络建立更新路由的准确映射。

##### 关于RIP v1,v2和OSPF
路由选择算法的步骤:

1. 向其他路由器传递路由信息
2. 接收其他路由器的路由信息
3. 根据收到的路由信息计算出到每个目的网络的最优路径，并由此生成路由选择表
4. 根据网络拓扑的变化及时作出反应，调整路由生成新的路由选择表，同时把拓扑变化以路由信息的形式向其他路由器宣告
 ---
两种主要算法:
* 距离向量算法 --- 距离矢量(如:RIP、IGRP、EIGRP)
* 链路状态算法 --- 链路状态路由协议(如:OSPF、IS-IS)
	
  路由协议是路由器之间实现路由信息共享的一种机制，它允许路由器之间相互交换和维护各自的路由表。当一台路由器的路由表由于某种原因发生变化时，它需要及时地将这一变化通知与之相连接的其他路由器，以保证数据的正确传递。路由协议不沉但网络上终端用户之间的数据传输任务
 ---
OSPF的操作过程
1. 路由器发送HELLO报文
2. 建立邻接关系
3. 形成链路状态  通过泛洪链路状态通告(LSA)形成相同链路状态数据库
4. SPF算法算出最优路径
5. 形成路由表

OSPF的特点:
1. 收敛速度快
2. 支持无类别的路由表查询、VLSM和超网技术
3. 支持等代价的多路负载均衡
4. 路由更新传递效率高
5. 根据链路的带宽进行最优选路

OSPF比RIP收敛快的原因:
	采用了区域、组播更新、增量更新、30分钟重发LSA
 --- 
RIP v1和v2的区别:
1. v1是有类路由协议，v2是无路由协议
2. v1广播路由更新，v2组播路由更新
3. v2路由更新所携带的信息比v1多
 ---
**RIP和OSPF的区别、特点**
  RIP协议是一种传统的路由协议，**适合比较小型的网络**，但是当前因特网的迅速发展和急剧膨胀使RIP协议**无法适应今天的网络**
  OSPF协议则是在因特网急剧膨胀时制定出来的，它克服了RIP协议的许多缺陷。RIP时距离矢量路由协议，OSPF是链路状态协议

  RIP的管理距离是120，OSPF的管理距离是110
  
1. RIP协议一条路由有15跳(网管或路由器)的限制，如果一个RIP网络路由跨越超过15跳(路由器)，则它人为网络不可达;
   OSPF 则对跨越路由的个数没有限制
2. OSPF协议支持可变长度的子网掩码(VLSM)。   
   RIP则不支持，这使得RIP协议对当前IP地址的缺乏和可变长度子网掩码的灵活性缺少支持
3. RIP协议不是针对网络的实际情况，而是定期地广播路由表，这对网络带宽资源是个极大的浪费，尤其是大型的广域网。  
   OSPF协议的路由广播更新只发生在路由状态变化的时候，采用IP多路广播来发送链路状态更新信息，可以节约贷款。
4. RIP是一个平面网络，对网络没有分层。   
   OSPF在网络中建立起层次概念，在自治域中可以划分网络域，使路由的广播限制在一定的范围内，避免链路中继资源浪费
5. OSPF在路由广播时采用了授权机制，保证了网络安全

上述差异显示了OSPF协议后来居上的特点，其先进性和复杂性使其称为主要的互联网路由协议。

##### 默认的路由管理距离
|路由来源|路由管理距离
|--------------------:|--------:|
|直连路由|0
|以一个接口为出口的静态路由|0
|以下一跳为出口的静态路由|1
|EIGRP的归纳路由|5
|外部BGP(EBGP)路由|20
|内部EIGRP|90
|IGRP|100
|OSPF|110
|IS-IS|115
|RIP v1/v2|120
|外部EIGRP|170
|内部BGP(EBGP)路由|200
|不可信路由|255

##### 路由表信息解读
	假设有  R 172.16.2.0/16 [120/1] via 172.16.12.2,06:07:08,(on Seria0/1)

其中，
* "R"代表该路由来源是通过RIP协议
* "172.16.2.0"表示目标网段为172.16.2.0
* "/16"表示子网掩码前16位为1，即255.255.0.0
* "[120/1]"指 管理距离/度量值，120是RIP的管理距离，度量值是1
* "via"指 下一跳
* "172.16.12.2"表示要想到达目标网段，下一个转发路由器的端口地址
* "06:07:08"表示这条路由在路由表中已存在 6小时07分08秒
* "on Serial 0/1"表示该条数据报将从本地路由Serial 0/1接口发送出去

##### 两大类路由协议
1.Classful(有类路由协议)
	RIP v1 , IGRP , EGP

2.Classless(无类路由协议)
	RIP v2 , EIGRP , OSPF , IS-IS , BGP
有类路由协议只会传送网络前缀(网络地址)，但是**不会包含子网掩码**。当A传送更新给B时，它会遵循以下步骤:
1. A检查192.168.1.0/24是否和192.168.2.0/30(更新传向过的网络)属于同一个**大一点的子网**
2. 答案为true，则A比较它们的子网掩码
3. 因为它们有两个不同的子网掩码，所以信息被丢弃

也就是说，有类路由协议传送更新时，要检查两点
* 直接连接的IP是否和发送更新的IP处于同一个较大的子网
* 两个IP的子网掩码是否相等
**若一个为否，则丢弃更新信息**
 --- 
无类路由协议传输网络前缀(网络地址)的同时也会传输子网掩码，所以它支持VLSM(可变长度子网掩码)
 --- 
有类地址

	早期的ip地址没有子网掩码，所有地址都属于相应的主类网
	距离矢量路由协议如RIP v1 ， IGRP属于有类路由协议
	它们不能从邻居那里学到子网，所有子网的路由被学到后自动转为相应的主类网
	譬如，182.16.1.0就会变成B类地址的主类网182.16.0.0
无类地址

	根据可变长度的子网掩码划分不同的网络。
	譬如182.16.1.101
	有类的话所在子网网段为182.16.0.0，子网掩码为255.255.0.0
	现在将子网掩码改为255.255.255.252的30位掩码
	所在子网网段就是182.16.1.100
	支持可变长度子网掩码的路由协议有RIP v2 , OSPF以及EIGRP

##### 内部网关和外部网关协议
###### 内部网关
  内部网关路由协议，IGP，是指在单个自治系统中处理路由选择的协议，它考虑在同一个公共网络管理下网络中的路由，
 包括RIP 、 OSPF 、 和IS-IS(中间系统-中间系统)等。

  通常，把一系列网络作为一个完整的系统进行管理，这就是自治系统(AS)，因特网是一系列自治系统的集合。

###### 外部网关
  外部网关路由协议，EGP，处理不同自治系统间的路由选择，被用来处理
  **不同自治系统**或者**不共享公共管理的网络之间的路由信息**

  EGP的一个例子是**边界网关协议，BGP4**。这个协议用于连接不同的AS。

## 广域网

### 广域网协议

* X.25(三层) ---  已被淘汰

其他数据链路层协议：
* **高级数据链路控制(HDLC)协议**，起源于SDLC，现在点对点协议PPP已经在很大程度上取代了广域网环境中的HDLC

+ **点到点协议(PPP)**,家庭拨号上网就是通过PPP在用户端和运营商的接入服务器之间建立通信链路
   - 典型的应用是在**ADSL**(非对称数据用户环线)接入
        + ADSL的主要特点：
        - 为用户提供**上行速率与下行速率**不相同。
            上行为低速的传输，从512Kbps到最高1Mbps;
            下行为高速传输，可从1.5Mbps到20Mbps。适用于**Internet的客户/服务器模式**
        - 直接利用**原有的电话网络**，**无需重新布线**
          **适合家庭使用**
        - 独享带宽,安全**可靠**
        - 语音和数据同时传输，**互不干扰**
        - 上网时不用拨号，一直在线(永久虚电路，但可能要验证用户名及密码，也叫虚拟拨号)

   - ISDN是使用PPP的典型范例
   - PPP与其他的协议共同派生出了符合宽带接入要求的新的协议，如PPPoE(PPP over Ethernet)，PPPoA(PPP over ATM)

+ **帧中继(Frame Relay)**,由于帧中继高效简单，能够根据需要分配网络带宽，因此得到了广泛地应用
   - 仅完成OSI物理层和链路层核心层的功能，将流量控制、纠错等留给智能终端去完成，大大简化了节点机之间的协议.
   - 采用虚电路技术，能充分利用网络资源，因而帧中继具有吞吐量高、时延低、适合突发性业务等特点
   - 主要应用在广域网中，支持多种数据型业务，如局域网互联、图像查询、图像监视和会议电视等

* 串行链路网际协议(SLIP),主要用于UNIX远程访问服务器中，现已基本被PPP取代

* 异步传输模式(ATM)

## 网络安全
### 网络安全的五层体系
+ 网络的安全性　
- 核心在于网络是否得到控制;

+ 操作系统的安全性　
- 在系统安全性问题中，主要考虑的问题有两个，一是病毒对于网络的威胁，二是入侵者对于网络的入侵和破坏;

+ 用户的安全性　
- 要考虑的问题是是否只有那些真正被授权的用户才能够使用系统中的资源和数据;

+ 应用程序的安全性　
- 要考虑的是是否只有合法的用户才能够对特定的数据进行合法的操作;

+ 数据的安全性　
- 机密数据是否处于机密状态是数据的安全性需要解决的问题。

### 网络安全的特征
1. 保密性
    - 信息只被授权对象使用
2. 完整性
    - 保持信息不被修改、不被破坏和丢失
3. 可用性（或坚固性）
    - 系统运行时能正确存取所需信息，当系统遭受攻击或破坏时，能迅速恢复并能投入使用
4. 不可否认性（真实性）
    - 所有参与者都不能否认或抵赖本人的真实身份，以及提供信息的原样性和完成的操作与承诺
5. 可控性
    - 信息传播及具体内容能够实现有效控制的特性。


